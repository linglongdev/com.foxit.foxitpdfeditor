#!/bin/bash
# generated by ll-helper

for i in `find "./linglong/sources" -name "*.deb"`;do
    dpkg -x "$i" $PREFIX
done

# /opt/apps/APP_ID/files => $PREFIX
# /opt/apps/APP_ID/entries => $PREFIX/share
# /usr => $PREFIX


function merge(){
    SRC=$1
    DEST=$2
    while read file;do
        FROM=$SRC/$file
        TO=$DEST/$file
        if [ -d "$FROM" ];then
            mkdir -p "$TO"
        elif [ -L "$TO" ];then
            echo RM $TO
            rm "$TO"
        else
            mv "$FROM" "$TO"
        fi
    done <<< `find "$SRC" -printf "%P\n"`
    rm -rf "$SRC"
}

merge $PREFIX/opt/apps/*/files $PREFIX
merge $PREFIX/opt/apps/*/entries $PREFIX/share
merge $PREFIX/usr $PREFIX
